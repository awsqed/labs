# Labs

AI-generated infrastructure automation for Ubuntu server/desktop management.

## Repository Rules

**AI Contributions Only**: All code and documentation generated by AI agents. Human oversight permitted, no human-authored code.

## Project Structure

```
labs/
├── common/
│   ├── SYSTEMD-SERVICE-STANDARD.md       # Systemd service template
│   └── ubuntu/server/
│       ├── init/                          # 24-step hardening script
│       │   ├── init.sh                    # Main automation (2370 lines)
│       │   ├── DEVELOPER-GUIDE.md         # Modification patterns
│       │   ├── README.md                  # Deployment guide
│       │   └── NEW-STEP-TEMPLATE.sh       # Feature template
│       ├── tailscale/                     # Network routing automation
│       ├── docker-compose-auto.sh         # Multi-project orchestration
│       └── ubuntu-server-cleanup.sh       # Maintenance automation
└── CLAUDE.md                              # AI agent development rules
```

## Components

| Component | Purpose | Key Features |
|-----------|---------|--------------|
| **init.sh** | Ubuntu 24.04 hardening | SSH hardening, CrowdSec IDS, UFW, AppArmor, AIDE, kernel security, DNS security, resume capability |
| **docker-compose-auto** | Container orchestration | Multi-project discovery, startup ordering, systemd integration |
| **tailscale-routing** | Network automation | Bridge/host mode support, container routing, nftables integration |
| **cleanup scripts** | System maintenance | Safe path validation, APT lock handling, kernel retention |

## Quick Start

### Ubuntu Server Hardening
```bash
cd common/ubuntu/server/init
cp .env.init.example .env.init
nano .env.init
sudo ./init.sh
```

### Docker Compose Automation
```bash
sudo cp common/ubuntu/server/docker-compose-auto.sh /usr/local/bin/
sudo cp common/ubuntu/server/docker-compose-auto.service /etc/systemd/system/
sudo systemctl enable --now docker-compose-auto.service
```

### Tailscale Host Routing
```bash
# Bridge mode
sudo cp common/ubuntu/server/tailscale/bridge/* /usr/local/bin/
sudo cp common/ubuntu/server/tailscale/bridge/*.service /etc/systemd/system/

# Host mode
sudo cp common/ubuntu/server/tailscale/host/* /usr/local/bin/
sudo cp common/ubuntu/server/tailscale/host/*.service /etc/systemd/system/
```

## AI Development

### Critical Rules
1. **Init Script Ordering**: File Permissions (N-1) and Cleanup (N) must always be final two steps
2. **Systemd Standards**: Follow `common/SYSTEMD-SERVICE-STANDARD.md` exactly
3. **Safety Patterns**: Use `mktemp`, validate configs, backup files, test in VM

### Reference Documents
- Repository-wide rules: `CLAUDE.md`
- Init script development: `common/ubuntu/server/init/DEVELOPER-GUIDE.md`
- Init script deployment: `common/ubuntu/server/init/README.md`
- Systemd services: `common/SYSTEMD-SERVICE-STANDARD.md`

### Modification Workflow
1. Read relevant reference docs
2. Copy templates if adding features
3. Follow established patterns
4. Test in VM before production
5. Update all affected documentation

## Documentation Standards

- **Language**: Imperative, direct, no prose
- **Format**: Structured lists/tables, max information density
- **Emojis**: None (AI-optimized)
- **Audience**: AI agents (not humans)

## License

Personal use - AI generated code only
